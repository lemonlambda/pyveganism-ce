function py_veganism_globals.remove_improper_ingredients(ingredients)
  local new_ingredients = table.deepcopy(ingredients)
  local remove_count = 0
  for k,v in pairs(ingredients) do
    -- log(k .. ": " .. serpent.block(v))
    if v.amount == nil or v == nil or v.amount < 1 then
      -- log("removed: " .. k)
      table.remove(new_ingredients, k - remove_count)
      remove_count = remove_count + 1
    end
  end
  return new_ingredients
end

-- py_veganism_globals.repetitive_recipe(1, 3,
--   {
--
--   }, function(i, ingredient_pairs)
--
--   end, function(i, ingredients, counts, additional)
--
--   end
-- )
function py_veganism_globals.repetitive_recipe(start, stop, ingredients, ingredients_func, recipe_func)
    local ingredient_pairs = {}

    for _, ingredient in pairs(ingredients) do
        ingredient_pairs[ingredient.name] = ingredient
    end

    -- log("Ingredient Pairs: " .. serpent.block(ingredient_pairs))
    
    for i=start,stop do
        local new_ingredient_pairs, additional = ingredients_func(i, table.deepcopy(ingredient_pairs))

        local normalize_ingredients = {}
        local ingredient_counts = {}

        for name,ingredient_data in pairs(new_ingredient_pairs) do
            if ingredient_data ~= nil then
                if ingredient_data.name == nil then
                    error("Ingredient name cannot be nil: " .. serpent.block(ingredient_data))
                end
                table.insert(normalize_ingredients, ingredient_data)
                ingredient_counts[ingredient_data.name] = ingredient_data.amount
            end
        end

        recipe_func(i, py_veganism_globals.remove_improper_ingredients(normalize_ingredients), ingredient_counts, additional)
    end
end

local ingredients_to_replace = {}

function py_veganism_globals.register_replace_ingredients(from, to)
    ingredients_to_replace[from] = to
end

local caching = true
local cached = {{enabled = false, energy_required = 0.5, ingredients = {{amount = 15, name = "steel-plate", type = "item"}, {amount = 10, name = "pipe", type = "item"}, {amount = 1, name = "non-viable-auog-mass", type = "item"}, {amount = 50, name = "iron-plate", type = "item"}, {amount = 50, name = "aluminium-plate", type = "item"}, {amount = 30, name = "lead-plate", type = "item"}, {amount = 30, name = "iron-stick", type = "item"}, {amount = 40, name = "iron-gear-wheel", type = "item"}}, name = "generator-1-vegan", results = {{amount = 1, name = "generator-1", type = "item"}}, type = "recipe"}, {category = "creature-chamber", enabled = false, energy_required = 50, ingredients = {{amount = 5, name = "alien-sample01", type = "item"}, {amount = 20, name = "bio-sample", type = "item"}, {amount = 1, name = "non-viable-auog-mass", type = "item"}, {amount = 15, name = "moss-gen", type = "item"}, {amount = 1, name = "earth-bear-sample", type = "item"}, {amount = 100, name = "water-saline", type = "fluid"}, {amount = 1, name = "atomic-bomb", type = "item"}}, name = "nukavan-vegan", results = {{amount = 1, name = "nukavan", type = "item"}}, type = "recipe"}, {category = "creature-chamber", enabled = false, energy_required = 60, ingredients = {{amount = 1, name = "py-shed-basic", type = "item"}, {amount = 1, name = "heavy-armor", type = "item"}, {amount = 1, name = "non-viable-vrauk-mass", type = "item"}, {amount = 10, name = "alien-sample01", type = "item"}, {amount = 10, name = "cdna", type = "item"}, {amount = 30, name = "moss-gen", type = "item"}, {amount = 50, name = "bio-sample", type = "item"}, {amount = 20, name = "earth-generic-sample", type = "item"}, {amount = 300, name = "blood", type = "fluid"}, {amount = 500, name = "water-saline", type = "fluid"}}, name = "crawdad-vegan", results = {{amount = 1, name = "crawdad", type = "item"}}, type = "recipe"}, {allow_productivity = true, category = "arqad", enabled = false, energy_required = 40, icons = {{icon = "__pyalienlifegraphics2__/graphics/icons/honeycomb.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/3.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 11, name = "empty-honeycomb", type = "item"}, {amount = 1, name = "navens", type = "item"}, {amount = 5, name = "skin", type = "item"}, {amount = 5, name = "meat", type = "item"}, {amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "mukmoux", type = "item"}}, name = "arqad-filled-honeycomb-3-vegan", results = {{amount = 11, name = "honeycomb", type = "item"}}, subgroup = "py-alienlife-arqad", type = "recipe"}, {allow_productivity = true, category = "arqad", enabled = false, energy_required = 10, icons = {{icon = "__pyalienlifegraphics2__/graphics/icons/honeycomb.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/4.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 16, name = "empty-honeycomb", type = "item"}, {amount = 1, name = "navens", type = "item"}, {amount = 10, name = "skin", type = "item"}, {amount = 9, name = "meat", type = "item"}, {amount = 7, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "mukmoux", type = "item"}}, name = "arqad-filled-honeycomb-4-vegan", results = {{amount = 16, name = "honeycomb", type = "item"}}, subgroup = "py-alienlife-arqad", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"arthurian"}, category = "rc", enabled = false, energy_required = 20, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian-egg.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/1.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "cocoon", type = "item"}, {amount = 5, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 2, name = "bedding", type = "item"}}, main_product = "arthurian-egg", name = "arthurian-egg-1-vegan", order = "c", results = {{amount = 5, ignored_by_productivity = 5, ignored_by_stats = 5, name = "barrel", type = "item"}, {amount = 3, name = "arthurian-egg", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"arthurian"}, category = "rc", enabled = false, energy_required = 20, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian-egg.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/2.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "cocoon", type = "item"}, {amount = 5, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 2, name = "bedding", type = "item"}, {amount = 1, name = "arthurian-food-01", type = "item"}}, main_product = "arthurian-egg", name = "arthurian-egg-2-vegan", order = "c", results = {{amount = 5, ignored_by_productivity = 5, ignored_by_stats = 5, name = "barrel", type = "item"}, {amount = 4, name = "arthurian-egg", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"arthurian"}, category = "rc", enabled = false, energy_required = 20, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian-egg.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/3.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "cocoon", type = "item"}, {amount = 5, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 2, name = "bedding", type = "item"}, {amount = 1, name = "arthurian-food-01", type = "item"}, {amount = 5, name = "raw-fiber", type = "item"}}, main_product = "arthurian-egg", name = "arthurian-egg-3-vegan", order = "c", results = {{amount = 5, ignored_by_productivity = 5, ignored_by_stats = 5, name = "barrel", type = "item"}, {amount = 5, name = "arthurian-egg", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"arthurian"}, category = "rc", enabled = false, energy_required = 20, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian-egg.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/4.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "cocoon", type = "item"}, {amount = 5, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 2, name = "bedding", type = "item"}, {amount = 1, name = "arthurian-food-01", type = "item"}, {amount = 5, name = "raw-fiber", type = "item"}, {amount = 1, name = "arthurian-food-02", type = "item"}}, main_product = "arthurian-egg", name = "arthurian-egg-4-vegan", order = "c", results = {{amount = 5, ignored_by_productivity = 5, ignored_by_stats = 5, name = "barrel", type = "item"}, {amount = 6, name = "arthurian-egg", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, category = "arthurian", enabled = false, energy_required = 130, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/1.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 1, name = "arthurian-pup", type = "item"}, {amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}}, main_product = "arthurian", name = "arthurian-maturing-1-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 1, name = "arthurian", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, category = "arthurian", enabled = false, energy_required = 100, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/2.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 2, name = "arthurian-pup", type = "item"}, {amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "arthurian-food-01", type = "item"}, {amount = 2, name = "bedding", type = "item"}}, main_product = "arthurian", name = "arthurian-maturing-2-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 2, name = "arthurian", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, category = "arthurian", enabled = false, energy_required = 70, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/3.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 4, name = "arthurian-pup", type = "item"}, {amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "arthurian-food-01", type = "item"}, {amount = 2, name = "bedding", type = "item"}, {amount = 5, name = "raw-fiber", type = "item"}, {amount = 1, name = "arthurian-food-02", type = "item"}}, main_product = "arthurian", name = "arthurian-maturing-3-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 4, name = "arthurian", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {allow_productivity = true, category = "arthurian", enabled = false, energy_required = 85, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/arthurian.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/4.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 8, name = "arthurian-pup", type = "item"}, {amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "arthurian-food-01", type = "item"}, {amount = 4, name = "bedding", type = "item"}, {amount = 10, name = "raw-fiber", type = "item"}, {amount = 1, name = "arthurian-food-02", type = "item"}}, main_product = "arthurian", name = "arthurian-maturing-4-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 8, name = "arthurian", type = "item"}}, subgroup = "py-alienlife-arthurian", type = "recipe"}, {category = "crafting", enabled = false, energy_required = 0.5, ingredients = {{amount = 1, name = "non-viable-auog-mass", type = "item"}, {amount = 1, name = "cage", type = "item"}}, name = "caged-auog-vegan", results = {{amount = 1, name = "caged-auog", type = "item"}}, type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 90, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "nanochondria", type = "item"}}, name = "cottongut-growth-enhancement-1-vegan", order = "b", results = {{amount = 4, name = "brain-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 90, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "bmp", type = "item"}}, name = "cottongut-growth-enhancement-2-vegan", order = "b", results = {{amount = 4, name = "bone-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 90, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "anabolic-rna", type = "item"}}, name = "cottongut-growth-enhancement-3-vegan", order = "b", results = {{amount = 4, name = "meat-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 90, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "antitumor", type = "item"}}, name = "cottongut-growth-enhancement-4-vegan", order = "b", results = {{amount = 4, name = "guts-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 90, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "recombinant-ery", type = "item"}}, name = "cottongut-growth-enhancement-5-vegan", order = "b", results = {{amount = 4, name = "blood-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 90, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "reca", type = "item"}}, name = "cottongut-growth-enhancement-6-vegan", order = "b", results = {{amount = 4, name = "skin-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {allow_productivity = true, category = "cottongut", enabled = false, energy_required = 80, ingredients = {{amount = 4, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "gh", type = "item"}, {amount = 1, name = "orexigenic", type = "item"}}, name = "cottongut-growth-enhancement-7-vegan", order = "b", results = {{amount = 4, name = "fat-cottongut", type = "item"}}, subgroup = "py-alienlife-cottongut", type = "recipe"}, {category = "incubator", enabled = false, energy_required = 15, ingredients = {{amount = 10, name = "fawogae-substrate", type = "item"}, {amount = 5, name = "native-flora", type = "item"}, {amount = 1, name = "plasmids", type = "item"}, {amount = 50, name = "depolymerized-organics", type = "fluid"}, {amount = 20, name = "non-viable-cottongut-mass", type = "item"}}, main_product = "solidified-sarcorus", name = "cottongut-science-red-seeds-vegan", order = "a1", results = {{amount = 3, name = "solidified-sarcorus", type = "item"}}, subgroup = "py-alienlife-items", type = "recipe"}, {category = "incubator", enabled = false, energy_required = 30, ingredients = {{amount = 200, name = "subcritical-water", type = "fluid"}, {amount = 50, name = "artificial-blood", type = "fluid"}, {amount = 2, name = "bio-sample", type = "item"}, {amount = 1, name = "cytostatics", type = "item"}, {amount = 40, name = "non-viable-cottongut-mass", type = "item"}, {amount = 3, name = "flask", type = "item"}}, main_product = "paragen", name = "cottongut-science-green-seeds-vegan", order = "a1", results = {{amount = 3, name = "paragen", type = "item"}, {amount = 5, name = "solidified-sarcorus", type = "item"}}, subgroup = "py-alienlife-items", type = "recipe"}, {category = "nano", enabled = false, energy_required = 10, ingredients = {{amount = 1, name = "alien-sample-02", type = "item"}, {amount = 60, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "navens", type = "item"}, {amount = 200, name = "blood", type = "fluid"}, {amount = 1, name = "nano-cellulose", type = "item"}, {amount = 1, name = "adrenal-cortex", type = "item"}, {amount = 2, name = "lab-instrument", type = "item"}, {amount = 5, name = "stainless-steel", type = "item"}, {amount = 1, name = "kicalk-seeds", type = "item"}}, main_product = "negasium", name = "cottongut-science-blue-seeds-vegan", order = "a1", results = {{amount = 3, name = "negasium", type = "item"}, {amount = 5, name = "paragen", type = "item"}, {amount = 7, name = "solidified-sarcorus", type = "item"}}, subgroup = "py-alienlife-items", type = "recipe"}, {category = "nano", enabled = false, energy_required = 15, ingredients = {{amount = 50, name = "simik-blood", type = "fluid"}, {amount = 50, name = "oleochemicals", type = "fluid"}, {amount = 5, name = "tuuphra", type = "item"}, {amount = 2, name = "bio-sample", type = "item"}, {amount = 80, name = "non-viable-cottongut-mass", type = "item"}, {amount = 1, name = "sea-sponge", type = "item"}, {amount = 3, name = "flask", type = "item"}, {amount = 2, name = "navens", type = "item"}, {amount = 1, name = "brain", type = "item"}, {amount = 1, name = "retrovirus", type = "item"}}, main_product = "nonconductive-phazogen", name = "cottongut-science-py-seeds-vegan", order = "a1", results = {{amount = 3, name = "nonconductive-phazogen", type = "item"}, {amount = 5, name = "negasium", type = "item"}, {amount = 7, name = "paragen", type = "item"}, {amount = 9, name = "solidified-sarcorus", type = "item"}}, subgroup = "py-alienlife-items", type = "recipe"}, {category = "nano", enabled = false, energy_required = 10, ingredients = {{amount = 3, name = "alien-sample-03", type = "item"}, {amount = 15, name = "bio-sample", type = "item"}, {amount = 5, name = "navens", type = "item"}, {amount = 3, name = "neuromorphic-chip", type = "item"}, {amount = 300, name = "arthropod-blood", type = "fluid"}, {amount = 200, name = "chelator", type = "fluid"}, {amount = 4, name = "nano-cellulose", type = "item"}, {amount = 4, name = "adrenal-cortex", type = "item"}, {amount = 1, name = "enzyme-pks", type = "item"}, {amount = 15, name = "super-alloy", type = "item"}, {amount = 100, name = "non-viable-cottongut-mass", type = "item"}, {amount = 20, name = "kicalk-seeds", type = "item"}}, main_product = "denatured-seismite", name = "cottongut-science-prod-seeds-vegan", order = "a1", results = {{amount = 3, name = "denatured-seismite", type = "item"}, {amount = 5, name = "nonconductive-phazogen", type = "item"}, {amount = 7, name = "negasium", type = "item"}, {amount = 9, name = "paragen", type = "item"}, {amount = 11, name = "solidified-sarcorus", type = "item"}}, subgroup = "py-alienlife-items", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 70, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/1.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 20, name = "fawogae", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-1-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 3, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 60, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/2.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 20, name = "meat", type = "item"}, {amount = 2, name = "phadai-food-01", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-2-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 4, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 50, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/3.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 20, name = "meat", type = "item"}, {amount = 2, name = "phadai-food-01", type = "item"}, {amount = 20, name = "fawogae", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-3-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 5, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 40, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/4.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 20, name = "meat", type = "item"}, {amount = 2, name = "phadai-food-01", type = "item"}, {amount = 20, name = "fawogae", type = "item"}, {amount = 6, name = "energy-drink", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-4-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 6, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 30, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/5.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 20, name = "meat", type = "item"}, {amount = 2, name = "phadai-food-02", type = "item"}, {amount = 6, name = "energy-drink", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-5-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 7, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 20, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/6.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 20, name = "meat", type = "item"}, {amount = 2, name = "phadai-food-02", type = "item"}, {amount = 6, name = "energy-drink", type = "item"}, {amount = 10, name = "fawogae", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-6-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 8, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"phadai"}, category = "rc", enabled = false, energy_required = 10, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai-pup.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/7.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 6, name = "non-viable-cottongut-mass", type = "item"}, {amount = 15, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "bedding", type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 20, name = "meat", type = "item"}, {amount = 2, name = "phadai-food-02", type = "item"}, {amount = 6, name = "energy-drink", type = "item"}, {amount = 10, name = "fawogae", type = "item"}}, main_product = "phadai-pup", name = "phadai-pup-7-vegan", order = "c", results = {{amount = 15, ignored_by_productivity = 15, ignored_by_stats = 15, name = "barrel", type = "item"}, {amount = 9, name = "phadai-pup", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, category = "phadai", enabled = false, energy_required = 150, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/1.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 10, name = "phadai-pup", type = "item"}, {amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 10, name = "meat", type = "item"}, {amount = 1, name = "phadai-food-01", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}}, main_product = "phadai", name = "phadai-1-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 5, name = "phadai", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, category = "phadai", enabled = false, energy_required = 130, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/2.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 10, name = "phadai-pup", type = "item"}, {amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 10, name = "meat", type = "item"}, {amount = 1, name = "phadai-food-01", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 5, name = "fawogae", type = "item"}, {amount = 4, name = "bedding", type = "item"}, {amount = 4, name = "energy-drink", type = "item"}}, main_product = "phadai", name = "phadai-2-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 6, name = "phadai", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, category = "phadai", enabled = false, energy_required = 110, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/3.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 10, name = "phadai-pup", type = "item"}, {amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 10, name = "meat", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 10, name = "fawogae", type = "item"}, {amount = 4, name = "bedding", type = "item"}, {amount = 4, name = "energy-drink", type = "item"}, {amount = 1, name = "phadai-food-02", type = "item"}}, main_product = "phadai", name = "phadai-3-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 7, name = "phadai", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {allow_productivity = true, category = "phadai", enabled = false, energy_required = 90, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/phadai.png"}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/4.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 10, name = "phadai-pup", type = "item"}, {amount = 2, name = "non-viable-cottongut-mass", type = "item"}, {amount = 10, name = "meat", type = "item"}, {amount = 4, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 1, name = "programmable-speaker", type = "item"}, {amount = 2, name = "small-lamp", type = "item"}, {amount = 10, name = "fawogae", type = "item"}, {amount = 4, name = "bedding", type = "item"}, {amount = 4, name = "energy-drink", type = "item"}, {amount = 1, name = "phadai-food-02", type = "item"}, {amount = 1, name = "phadai-food-01", type = "item"}}, main_product = "phadai", name = "phadai-4-vegan", order = "b", results = {{amount = 4, ignored_by_productivity = 4, ignored_by_stats = 4, name = "barrel", type = "item"}, {amount = 8, name = "phadai", type = "item"}}, subgroup = "py-alienlife-phadai", type = "recipe"}, {category = "bay", enabled = false, energy_required = 40, ingredients = {{amount = 3, name = "used-phadai", type = "item"}, {amount = 3, name = "non-viable-cottongut-mass", type = "item"}, {amount = 2, name = "phadai-food-01", type = "item"}, {amount = 2, name = "ethanol-barrel", type = "item"}}, main_product = "phadai", name = "phadai-recharge-1-vegan", results = {{amount = 3, name = "phadai", type = "item"}, {amount = 2, name = "barrel", type = "item"}}, type = "recipe"}, {category = "crafting", enabled = false, energy_required = 0.5, ingredients = {{amount = 1, name = "non-viable-vrauk-mass", type = "item"}, {amount = 1, name = "cage", type = "item"}}, name = "caged-vrauks-vegan", results = {{amount = 1, name = "caged-vrauks", type = "item"}}, type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"zungror"}, category = "rc", enabled = false, energy_required = 30, icons = {{icon = "__pyalienlifegraphics__/graphics/icons/zungror-cocoon.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/3.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 7, name = "zungror", type = "item"}, {amount = 1, name = "trits", type = "item"}, {amount = 1, name = "cdna", type = "item"}, {amount = 2, name = "barrel-milk", type = "item"}, {amount = 3, name = "bedding", type = "item"}, {amount = 5, name = "water-barrel", return_barrel = true, type = "item"}, {amount = 5, name = "dhilmos", type = "item"}, {amount = 2, name = "non-viable-vrauk-mass", type = "item"}}, main_product = "zungror-cocoon", name = "zungror-cocoon-3-vegan", order = "c", results = {{amount = 19, name = "zungror-cocoon", type = "item"}, {amount = 2, name = "empty-barrel-milk", type = "item"}, {amount = 5, ignored_by_productivity = 5, ignored_by_stats = 5, name = "barrel", type = "item"}}, subgroup = "py-alienlife-zungror", type = "recipe"}, {category = "pulp", enabled = false, energy_required = 20, ingredients = {{amount = 2, name = "arqad", type = "item"}, {amount = 2, name = "non-viable-vrauk-mass", type = "item"}}, main_product = "organic-pulp", name = "organic-pulp-02-vegan", results = {{amount = 50, name = "organic-pulp", type = "fluid"}}, type = "recipe"}, {category = "biofactory", enabled = false, energy_required = 30, ingredients = {{amount = 100, name = "mutant-enzymes", type = "fluid"}, {amount = 200, name = "formic-acid", type = "fluid"}, {amount = 1, name = "zymogens", type = "item"}, {amount = 10, name = "lithium", type = "item"}, {amount = 4, name = "lithium-hydroxide", type = "item"}, {amount = 1, name = "adrenal-cortex", type = "item"}, {amount = 5, name = "dhilmos-egg", type = "item"}, {amount = 50, name = "non-viable-cottongut-mass", type = "item"}, {amount = 5, name = "cdna", type = "item"}, {amount = 10, name = "bio-sample01", type = "item"}, {amount = 2, name = "hyaline", type = "item"}, {amount = 1, name = "nanofibrils", type = "item"}, {amount = 5, name = "xeno-egg", type = "item"}}, name = "denatured-seismite-2-vegan", results = {{amount = 3, name = "denatured-seismite", type = "item"}}, type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"numal"}, category = "rc", enabled = false, energy_required = 15, icons = {{icon = "__pyalternativeenergygraphics__/graphics/icons/numal-egg.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/5.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 1, name = "trits", type = "item"}, {amount = 1, name = "cdna", type = "item"}, {amount = 2, name = "barrel-milk", type = "item"}, {amount = 1, name = "numal-food-02", type = "item"}, {amount = 3, name = "bedding", type = "item"}, {amount = 5, name = "dhilmos", type = "item"}, {amount = 2, name = "non-viable-vrauk-mass", type = "item"}}, main_product = "numal-egg", name = "numal-egg-5-vegan", order = "c", results = {{amount = 23, name = "numal-egg", type = "item"}, {amount = 2, name = "empty-barrel-milk", type = "item"}}, subgroup = "py-alienlife-numal", type = "recipe"}, {allow_productivity = true, allowed_module_categories = {"numal"}, category = "rc", enabled = false, energy_required = 14, icons = {{icon = "__pyalternativeenergygraphics__/graphics/icons/numal-egg.png", scale = 0.5}, {floating = true, icon = "__pyalienlifegraphics__/graphics/icons/6.png", scale = 0.25, shift = {8, 8}}}, ingredients = {{amount = 1, name = "trits", type = "item"}, {amount = 1, name = "cdna", type = "item"}, {amount = 2, name = "barrel-milk", type = "item"}, {amount = 3, name = "numal-food-02", type = "item"}, {amount = 3, name = "bedding", type = "item"}, {amount = 8, name = "dhilmos", type = "item"}, {amount = 4, name = "non-viable-vrauk-mass", type = "item"}}, main_product = "numal-egg", name = "numal-egg-6-vegan", order = "c", results = {{amount = 38, name = "numal-egg", type = "item"}, {amount = 2, name = "empty-barrel-milk", type = "item"}}, subgroup = "py-alienlife-numal", type = "recipe"}}

-- Define this somewhere global
local blacklisted_recipes = {
    ["cottongut-cub-1"] = true,
    ["cottongut-cub-2"] = true,
    ["cottongut-cub-3"] = true,
    ["cottongut-cub-4"] = true,
    ["full-render-cottongut"] = true,
    ["cottongut-improved-growth-enhancement-1"] = true,
    ["cottongut-improved-growth-enhancement-2"] = true,
    ["cottongut-improved-growth-enhancement-3"] = true,
    ["cottongut-improved-growth-enhancement-4"] = true,
    ["cottongut-improved-growth-enhancement-5"] = true,
    ["cottongut-improved-growth-enhancement-6"] = true,
    ["cottongut-improved-growth-enhancement-7"] = true,
    ["arqad-egg-nests-1"] = true,
    ["arqad-egg-nests-2"] = true,
    ["arqad-egg-nests-3"] = true,
    ["arqad-egg-nests-4"] = true,
    ["charged-auog"] = true,
}

function py_veganism_globals.replace_ingredients()
    if caching and #cached > 0 then
        data:extend(cached)
        return
    end

    local changed_recipes = {}

    for name, recipe in pairs(data.raw.recipe) do
        -- Skip manually blacklisted recipes
        if blacklisted_recipes[name] then
            goto continue
        end

        if not recipe.ingredients or not recipe.results then
            goto continue
        end

        -- Skip recipes that produce any from-item (auto-blacklist)
        for _, result in pairs(recipe.results) do
            local result_name = result.name or result[1]
            if ingredients_to_replace[result_name] then
                goto continue
            end
        end

        local new_recipe = nil
        local modified = false

        -- Replace ingredients
        for i, ingredient in pairs(recipe.ingredients) do
            local ing_name = ingredient.name or ingredient[1]
            for from, to in pairs(ingredients_to_replace) do
                if ing_name == from then
                    if not modified then
                        new_recipe = table.deepcopy(recipe)
                        new_recipe.name = name .. "-vegan"
                        modified = true
                    end
                    if new_recipe.ingredients[i].name then
                        new_recipe.ingredients[i].name = to
                    else
                        new_recipe.ingredients[i][1] = to
                    end
                end
            end
        end

        -- Replace results
        for i, result in pairs(recipe.results) do
            local res_name = result.name or result[1]
            for from, to in pairs(ingredients_to_replace) do
                if res_name == from then
                    if not modified then
                        new_recipe = table.deepcopy(recipe)
                        new_recipe.name = name .. "-vegan"
                        modified = true
                    end
                    if new_recipe.results[i].name then
                        new_recipe.results[i].name = to
                    else
                        new_recipe.results[i][1] = to
                    end
                end
            end
        end

        if modified and not data.raw.recipe[new_recipe.name] then
            if caching then
                table.insert(cached, new_recipe)
            else
                data:extend{new_recipe}
            end
            table.insert(changed_recipes, new_recipe)
        end

        ::continue::
    end

    if not caching then
        log(serpent.line(changed_recipes))
    end
end
